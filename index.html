<!-- ‚úÖ FINAL index.html (FULL FILE) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scraper Builder</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#0b0f14; color:#e8eef6; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 22px; }
    .grid { display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }
    .card { background:#111826; border:1px solid #1c2a40; border-radius:14px; padding:16px; }
    h1 { margin:0 0 8px; font-size:22px; }
    .sub { margin:0 0 14px; opacity:.82; }
    h2 { margin: 0 0 10px; font-size: 15px; }
    label { display:block; font-size:12px; opacity:.85; margin: 10px 0 6px; }
    input, textarea, button, select {
      width:100%; box-sizing:border-box;
      border-radius:10px; border:1px solid #243651;
      background:#0f1726; color:#e8eef6;
      padding:10px 12px; outline:none;
    }
    textarea { min-height: 260px; font-family: ui-monospace, Menlo, Consolas, monospace; font-size: 12px; line-height: 1.4; }
    button { cursor:pointer; border:1px solid #2b425f; }
    .btns { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .good { background:#16a34a22; border-color:#22c55e; }
    .primary { background:#1b4dff22; border-color:#2c63ff; }
    .ghost { background:transparent; }
    .pillSmall { display:inline-block; font-size:11px; padding: 4px 8px; border-radius:999px; border:1px solid #2b425f; opacity:.95; }
    .muted { opacity:.78; font-size:12px; }
    .tiny { opacity:.78; font-size:11px; }
    hr { border:none; border-top:1px solid #1c2a40; margin:14px 0; }
    code { background:#0a1220; border:1px solid #20304a; padding: 1px 6px; border-radius: 6px; }

    /* Pretty draggable pill */
    .pillGreen{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid #14532d;
      background: linear-gradient(180deg, rgba(34,197,94,.25), rgba(34,197,94,.10));
      color:#eafff1;
      text-decoration:none;
      font-weight:700;
      box-shadow: 0 6px 18px rgba(34,197,94,.12);
      user-select:none;
    }
    .pillGreen:hover{
      border-color:#22c55e;
      box-shadow: 0 10px 22px rgba(34,197,94,.16);
    }
    .pillGreen:active{ transform: translateY(1px); }
  </style>
</head>

<body>
  <div class="wrap">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;">
      <div>
        <h1>Scraper Builder <span class="pillSmall">Free ‚Ä¢ GitHub Pages</span></h1>
        <div class="sub">
          Drag selector ‚Üí click item ‚Üí (optional) click Pages ‚Üí paste config ‚Üí copy console script ‚Üí CSV.
        </div>
      </div>
      <div class="pillSmall">No backend ‚Ä¢ No API key</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Step 1 ‚Äî Add ‚ÄúSelector‚Äù to your bookmarks bar</h2>
        <div class="muted">
          Drag the green pill below onto your bookmarks bar.
          <b>Don‚Äôt click it</b> ‚Äî it‚Äôs meant to be dragged.
          <br/>If drag is blocked, use <b>Copy</b> ‚Üí Bookmark Manager ‚Üí paste into the bookmark URL.
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px;">
          <a id="bookmarkletPretty" class="pillGreen" href="javascript:void(0)" draggable="true">üü¢ Selector</a>
          <button id="copyBookmarklet" class="good" style="width:auto;">Copy</button>
          <button id="toggleAdvanced" class="ghost" style="width:auto;">Advanced</button>
        </div>

        <div class="tiny muted" id="pickHelp" style="margin-top:8px;"></div>

        <div id="advancedBox" style="display:none; margin-top:12px;">
          <label>Bookmarklet URL (manual copy/paste fallback)</label>
          <textarea id="bookmarkletCode" style="min-height:120px;"></textarea>
        </div>

        <hr/>

        <h2>Step 2 ‚Äî Paste selector output</h2>
        <label>Selector Output (JSON)</label>
        <textarea id="config" placeholder='Paste the JSON you got after picking item + Pages (or Esc for no Pages)...'></textarea>

        <div class="btns">
          <button id="loadConfig" class="primary">Load config</button>
          <button id="clearConfig" class="ghost">Clear</button>
        </div>

        <div class="tiny" id="status" style="margin-top:10px;"></div>

        <hr/>

        <h2>Step 3 ‚Äî Generate console scraper</h2>

        <label>Section name</label>
        <input id="sectionName" placeholder="Exhibitors | Speakers | Sponsors | Sessions ..." />

        <label>Row/Card selector</label>
        <input id="rowSelector" placeholder="e.g. li.block-list__item" />

        <label>Item link selector (inside each row)</label>
        <input id="itemSelector" placeholder="e.g. strong.block-list__title a" />

        <label>Pages mode</label>
        <select id="pagMode">
          <option value="indexPages">Pages (Index links) ‚Äî recommended</option>
          <option value="none">No pages (single page)</option>
          <option value="fetchPages">Pages (crawl links)</option>
          <option value="nextButton">Pages (click Next ‚Äî AJAX)</option>
          <option value="loadMore">Pages (Load more)</option>
        </select>

        <label>Pages selector</label>
        <input id="pagSelector" placeholder='For indexPages: a[href*="/Exhibitors/Index/"] (or Speakers/Sponsors)‚Ä¶' />

        <div class="btns">
          <button id="copyScript" class="good">Copy script</button>
        </div>

        <div class="muted" style="margin-top:10px;">
          Run on the target page: DevTools ‚Üí Console ‚Üí paste ‚Üí Enter.
        </div>
      </div>

      <div class="card">
        <h2>Generated Script</h2>
        <div class="muted">
          Best mode: crawl all <code>/${SECTION}/Index/</code> pages ‚Üí fetch each ‚Üí scrape rows ‚Üí CSV.
          If a site has no Pages, the script will say so and export what‚Äôs available.
        </div>
        <label>Console Script</label>
        <textarea id="out" spellcheck="false" style="min-height:560px;"></textarea>
      </div>
    </div>
  </div>

<script>
  function setStatus(msg, ok=true){
    const s=document.getElementById("status");
    s.textContent=msg;
    s.style.color = ok ? "#86efac" : "#fca5a5";
    setTimeout(()=>{ s.textContent=""; s.style.color=""; }, 2500);
  }

  function generateScript({sectionName, rowSelector, itemSelector, pagesMode, pagesSelector}) {
    const SECTION = (sectionName || "").trim();
    if(!SECTION) return "// Provide sectionName (e.g. Exhibitors / Speakers / Sponsors)\n";
    if(!rowSelector || !itemSelector) return "// Provide rowSelector and itemSelector.\n";

    const mode = pagesMode || "indexPages";
    const sel = pagesSelector || "";

    return `(async () => {
  const SECTION = ${JSON.stringify(SECTION)};
  const MODE = ${JSON.stringify(mode)}; // indexPages | none | fetchPages | nextButton | loadMore
  const ROW_SEL = ${JSON.stringify(rowSelector)};
  const ITEM_SEL = ${JSON.stringify(itemSelector)};
  const PAGES_SEL = ${JSON.stringify(sel)};
  const MAX_STEPS = 10; // nextButton only

  const sleep = (ms) => new Promise(r => setTimeout(r, ms));
  const rand = (a,b) => Math.floor(Math.random()*(b-a+1))+a;

  function absUrl(href){
    if(!href) return null;
    try { return new URL(href, location.origin).toString(); } catch { return href; }
  }

  function scrapeRowsFromDoc(doc){
    const rows = [...doc.querySelectorAll(ROW_SEL)];
    const out = [];
    for (const row of rows) {
      const a = (row.matches && row.matches(ITEM_SEL)) ? row : row.querySelector(ITEM_SEL);
      const name = (a?.textContent || "").trim().replace(/\\s+/g, " ") || null;
      const url = absUrl(a?.getAttribute("href"));
      if (name && url) out.push({ name, url });
    }
    return out;
  }

  async function clickNext(){
    const btn = document.querySelector(PAGES_SEL);
    if(!btn) return false;
    btn.click();
    await sleep(rand(700, 1300));
    return true;
  }

  async function clickLoadMore(){
    while(true){
      const btn = document.querySelector(PAGES_SEL);
      if(!btn) break;
      if(btn.disabled) break;
      btn.click();
      await sleep(rand(700, 1300));
    }
    return true;
  }

  const map = new Map();

  if (MODE === "indexPages") {
    const baseUrl = location.origin;

    const indexSel = (PAGES_SEL && PAGES_SEL.trim())
      ? PAGES_SEL.trim()
      : \`a[href*="/\${SECTION}/Index/"]\`;

    const queue = [];
    const seen = new Set();

    function addUrl(u){
      if(!u) return;
      const clean = u.split("#")[0];
      if(!seen.has(clean)){ seen.add(clean); queue.push(clean); }
    }

    addUrl(location.href);
    [...document.querySelectorAll(indexSel)].forEach(a => {
      const href = a.getAttribute("href");
      if(!href) return;
      addUrl(new URL(href, baseUrl).href);
    });

    console.log("Pages seeded:", queue.length);
    if (queue.length <= 1) {
      console.warn("‚ö†Ô∏è No extra Pages detected (Index links). This site may be single-page. Exporting what‚Äôs available.");
    }

    while(queue.length){
      const url = queue.shift();
      console.log("Fetching:", url);

      const res = await fetch(url, { credentials: "include" });
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, "text/html");

      const items = scrapeRowsFromDoc(doc);
      for(const it of items) map.set(it.url, it.name);

      [...doc.querySelectorAll(indexSel)].forEach(a => {
        const href = a.getAttribute("href");
        if(!href) return;
        addUrl(new URL(href, baseUrl).href);
      });
    }

    console.log("Total Pages crawled:", seen.size);
    if (seen.size <= 1) {
      console.warn("‚ÑπÔ∏è This site doesn‚Äôt expose multiple Pages via Index links. If you expected more, try Pages mode = 'No pages' or 'Pages (crawl links)'.");
    }

  } else if (MODE === "fetchPages") {
    const baseUrl = location.origin;
    const queue = [];
    const seen = new Set();

    function addUrl(u){
      if(!u) return;
      const clean = u.split("#")[0];
      if(!seen.has(clean)){ seen.add(clean); queue.push(clean); }
    }

    addUrl(location.href);
    [...document.querySelectorAll(PAGES_SEL)].forEach(a => {
      const href = a.getAttribute("href");
      if(!href) return;
      addUrl(new URL(href, baseUrl).href);
    });

    console.log("Pages seeded:", queue.length);
    if (queue.length <= 1) console.warn("‚ö†Ô∏è No extra Pages detected from the Pages selector. Exporting what‚Äôs available.");

    while(queue.length){
      const url = queue.shift();
      console.log("Fetching:", url);

      const res = await fetch(url, { credentials: "include" });
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, "text/html");

      const items = scrapeRowsFromDoc(doc);
      for(const it of items) map.set(it.url, it.name);

      [...doc.querySelectorAll(PAGES_SEL)].forEach(a => {
        const href = a.getAttribute("href");
        if(!href) return;
        addUrl(new URL(href, baseUrl).href);
      });
    }

  } else if (MODE === "none") {
    console.log("No Pages mode ‚Äî scraping current page only.");
    const items = scrapeRowsFromDoc(document);
    for(const it of items) map.set(it.url, it.name);

  } else {
    let lastSize = 0;

    for(let step=1; step<=MAX_STEPS; step++){
      if(MODE==="loadMore") await clickLoadMore();

      const items = scrapeRowsFromDoc(document);
      for(const it of items) map.set(it.url, it.name);

      console.log(\`Step \${step} ‚Äî page items: \${items.length} ‚Äî total unique: \${map.size}\`);

      if(map.size === lastSize) break;
      lastSize = map.size;

      if(MODE==="nextButton"){
        const ok = await clickNext();
        if(!ok) {
          console.warn("‚ö†Ô∏è Next button not found. This site may not support Pages in this mode. Exporting what‚Äôs available.");
          break;
        }
      } else {
        break;
      }

      await sleep(rand(700, 1300));
    }
  }

  const rows = [
    ["Name","URL"],
    ...[...map.entries()].map(([url,name]) => [
      \`"\${String(name).replace(/"/g,'""')}"\`,
      \`"\${url}"\`
    ])
  ];
  const csv = rows.map(r => r.join(",")).join("\\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = \`\${SECTION.toLowerCase()}_export.csv\`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  console.log(\`‚úÖ Exported \${map.size} items\`);
})();`;
  }

  function updateOutput() {
    const sectionName = document.getElementById("sectionName").value.trim();
    const rowSelector = document.getElementById("rowSelector").value.trim();
    const itemSelector = document.getElementById("itemSelector").value.trim();
    const pagesMode = document.getElementById("pagMode").value;
    const pagesSelector = document.getElementById("pagSelector").value.trim();

    document.getElementById("out").value = generateScript({
      sectionName,
      rowSelector,
      itemSelector,
      pagesMode,
      pagesSelector
    });
  }

  function setBookmarkletCode(){
    const pickerUrl = new URL("picker.js", window.location.href).toString();

    const code =
`javascript:(()=>{var s=document.createElement('script');s.src=${JSON.stringify(pickerUrl)}+'?v='+Date.now();document.documentElement.appendChild(s);})();`;

    document.getElementById("bookmarkletPretty").setAttribute("href", code);

    document.getElementById("copyBookmarklet").onclick = async () => {
      try { await navigator.clipboard.writeText(code); setStatus("Copied bookmarklet ‚úÖ"); }
      catch { setStatus("Clipboard blocked ‚Äî open Advanced and copy manually.", false); }
    };

    const adv = document.getElementById("advancedBox");
    document.getElementById("toggleAdvanced").onclick = () => {
      adv.style.display = (adv.style.display === "none") ? "block" : "none";
    };

    document.getElementById("bookmarkletCode").value = code;

    document.getElementById("pickHelp").textContent =
      "Drag üü¢ Selector to bookmarks bar. On any site: click üü¢ Selector ‚Üí click an item ‚Üí click Pages (or press Esc if there are no Pages).";
  }

  // UI wiring
  document.getElementById("loadConfig").addEventListener("click", () => {
    const txt = document.getElementById("config").value.trim();
    if(!txt) return setStatus("Paste the JSON config first.", false);

    try {
      const cfg = JSON.parse(txt);

      document.getElementById("sectionName").value = cfg.sectionName || cfg.section || "";
      document.getElementById("rowSelector").value = cfg.rowSelector || "";
      document.getElementById("itemSelector").value = cfg.itemSelector || "";
      document.getElementById("pagMode").value = (cfg.pagination?.mode || cfg.pages?.mode || "indexPages");
      document.getElementById("pagSelector").value = (cfg.pagination?.selector || cfg.pages?.selector || "");

      if(!document.getElementById("rowSelector").value) document.getElementById("rowSelector").value = "li.block-list__item";
      if(!document.getElementById("itemSelector").value) document.getElementById("itemSelector").value = "strong.block-list__title a";

      updateOutput();
      setStatus("Loaded config ‚úÖ", true);
    } catch {
      setStatus("That doesn‚Äôt look like valid JSON.", false);
    }
  });

  document.getElementById("clearConfig").addEventListener("click", () => {
    document.getElementById("config").value = "";
    setStatus("Cleared.");
  });

  ["sectionName","rowSelector","itemSelector","pagMode","pagSelector"].forEach(id=>{
    document.getElementById(id).addEventListener("input", updateOutput);
    document.getElementById(id).addEventListener("change", updateOutput);
  });

  document.getElementById("copyScript").addEventListener("click", async () => {
    const text = document.getElementById("out").value;
    try { await navigator.clipboard.writeText(text); setStatus("Copied script ‚úÖ"); }
    catch { setStatus("Clipboard blocked‚Äîcopy manually.", false); }
  });

  // Init
  setBookmarkletCode();
  updateOutput();
</script>
</body>
</html>
